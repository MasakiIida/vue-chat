{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport firebase from \"@/firebase/firebase\";\nimport SideBar from \"@/components/layouts/SideBar\";\nimport DeleteRoom from \"@/components/modal/DeleteRoom\";\nexport default {\n  components: {\n    SideBar,\n    DeleteRoom\n  },\n\n  async created() {\n    this.roomId = this.$route.query.room_id;\n    console.log(\"roomId\", this.roomId);\n    const roomRef = firebase.firestore().collection(\"rooms\").doc(this.roomId);\n    const roomDoc = await roomRef.get();\n\n    if (!roomDoc.exists) {\n      await this.$router.push(\"/\");\n    }\n\n    this.room = roomDoc.data();\n    console.log(\"room\", this.room);\n  },\n\n  mounted() {\n    this.auth = JSON.parse(sessionStorage.getItem(\"user\"));\n    console.log(this.auth);\n    const roomRef = firebase.firestore().collection(\"rooms\").doc(this.roomId);\n    roomRef.collection(\"messages\").orderBy(\"createdAt\", \"asc\").onSnapshot(snapshot => {\n      snapshot.docChanges().forEach(change => {\n        console.log(\"new message\", change.doc.data());\n        this.messages.push(change.doc.data());\n      });\n    });\n  },\n\n  data: () => ({\n    messages: [],\n    body: \"\",\n    roomId: \"\",\n    room: null,\n    cards: [\"トーク\"],\n    drawer: null,\n    n: \"\",\n    auth: null\n  }),\n  computed: {\n    invalid() {\n      if (!this.body) {\n        return true;\n      }\n\n      return false;\n    }\n\n  },\n  methods: {\n    clear() {\n      this.body = \"\";\n    },\n\n    submit() {\n      const roomRef = firebase.firestore().collection(\"rooms\").doc(this.roomId);\n      roomRef.collection(\"messages\").add({\n        message: this.body,\n        name: this.auth.displayName,\n        photoURL: this.auth.photoURL,\n        createdAt: firebase.firestore.Timestamp.now()\n      }).then(result => {\n        console.log(\"success\", result);\n        this.body = \"\";\n      }).catch(error => {\n        console.log(\"fail\", error);\n        alert(\"メッセージの送信に失敗しました\");\n      });\n    } // deleteRoom() {\n    //  const room_id = this.$route.query.room_id;\n    //  firebase\n    //   .firestore()\n    //   .collection(\"rooms\")\n    //   .doc(room_id)\n    //   .delete()\n    //   .then(() => {\n    //    this.$router.push(\"/\");\n    //    console.log(room_id, \"は削除されました\");\n    //   });\n    // },\n\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AAEA;AACAA;AACAC,WADA;AAEAC;AAFA,GADA;;AAKA;AACA;AACAC;AAEA;AACA;;AACA;AACA;AACA;;AACA;AACAA;AACA,GAhBA;;AAiBAC;AACA;AACAD;AAEA;AACAE,YACAC,UADA,CACA,UADA,EAEAC,OAFA,CAEA,WAFA,EAEA,KAFA,EAGAC,UAHA,CAGAC;AACAA;AACAN;AACA;AACA,OAHA;AAIA,KARA;AASA,GA/BA;;AAgCAO;AACAC,gBADA;AAEAC,YAFA;AAGAC,cAHA;AAIAC,cAJA;AAKAC,kBALA;AAMAC,gBANA;AAOAC,SAPA;AAQAC;AARA,IAhCA;AA0CAC;AACAC;AACA;AACA;AACA;;AACA;AACA;;AANA,GA1CA;AAkDAC;AACAC;AACA;AACA,KAHA;;AAIAC;AACA;AACAlB,cACAC,UADA,CACA,UADA,EAEAkB,GAFA,CAEA;AACAC,0BADA;AAEAC,mCAFA;AAGAC,oCAHA;AAIAC;AAJA,OAFA,EAQAC,IARA,CAQAC;AACA3B;AACA;AACA,OAXA,EAYA4B,KAZA,CAYAC;AACA7B;AACA8B;AACA,OAfA;AAgBA,KAtBA,CAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAnCA;AAlDA","names":["components","SideBar","DeleteRoom","console","mounted","roomRef","collection","orderBy","onSnapshot","snapshot","data","messages","body","roomId","room","cards","drawer","n","auth","computed","invalid","methods","clear","submit","add","message","name","photoURL","createdAt","then","result","catch","error","alert"],"sourceRoot":"src/views","sources":["ChatBoard.vue"],"sourcesContent":["<template>\n <v-app id=\"inspire\">\n  <v-app-bar app>\n   <v-app-bar-nav-icon @click=\"drawer = !drawer\"></v-app-bar-nav-icon>\n   <v-toolbar-title class=\"room-title d-flex\">\n    <h2>{{ room ? room.name : \"\" }}</h2>\n    <DeleteRoom />\n    <!-- <v-btn color=\"error\" fab small right absolute @click=\"deleteRoom\"\n     ><v-icon @click=\"deleteRoom\">mdi-trash-can</v-icon></v-btn\n    > -->\n   </v-toolbar-title>\n  </v-app-bar>\n  <v-navigation-drawer v-model=\"drawer\" app light>\n   <SideBar />\n  </v-navigation-drawer>\n  <v-main>\n   <v-container class=\"py-8 px-6\" fluid>\n    <v-row>\n     <v-col v-for=\"card in cards\" :key=\"card\" cols=\"12\">\n      <v-card>\n       <v-subheader>{{ card }}</v-subheader>\n\n       <v-list two-line>\n        <template v-for=\"(data, index) in messages\">\n         <v-list-item :key=\"index\">\n          <v-list-item-avatar color=\"grey darken-1\">\n           <v-img :src=\"data.photoURL\"></v-img>\n          </v-list-item-avatar>\n\n          <v-list-item-content>\n           <v-list-item-subtitle class=\"message\">\n            {{ data.message }}\n           </v-list-item-subtitle>\n          </v-list-item-content>\n         </v-list-item>\n\n         <v-divider v-if=\"n !== 6\" :key=\"`divider-${index}`\" inset></v-divider>\n        </template>\n       </v-list>\n      </v-card>\n     </v-col>\n    </v-row>\n   </v-container>\n   <v-textarea\n    v-model=\"body\"\n    append-outer-icon=\"mdi-comment\"\n    class=\"mx-2\"\n    label=\"メッセージを送信する\"\n    rows=\"3\"\n    auto-grow\n   ></v-textarea>\n   <v-btn class=\"mr-4\" type=\"submit\" :disabled=\"invalid\" @click=\"submit\">\n    submit\n   </v-btn>\n   <v-btn @click=\"clear\"> clear </v-btn>\n  </v-main>\n </v-app>\n</template>\n\n<script>\nimport firebase from \"@/firebase/firebase\";\nimport SideBar from \"@/components/layouts/SideBar\";\nimport DeleteRoom from \"@/components/modal/DeleteRoom\";\n\nexport default {\n components: {\n  SideBar,\n  DeleteRoom,\n },\n async created() {\n  this.roomId = this.$route.query.room_id;\n  console.log(\"roomId\", this.roomId);\n\n  const roomRef = firebase.firestore().collection(\"rooms\").doc(this.roomId);\n  const roomDoc = await roomRef.get();\n  if (!roomDoc.exists) {\n   await this.$router.push(\"/\");\n  }\n  this.room = roomDoc.data();\n  console.log(\"room\", this.room);\n },\n mounted() {\n  this.auth = JSON.parse(sessionStorage.getItem(\"user\"));\n  console.log(this.auth);\n\n  const roomRef = firebase.firestore().collection(\"rooms\").doc(this.roomId);\n  roomRef\n   .collection(\"messages\")\n   .orderBy(\"createdAt\", \"asc\")\n   .onSnapshot((snapshot) => {\n    snapshot.docChanges().forEach((change) => {\n     console.log(\"new message\", change.doc.data());\n     this.messages.push(change.doc.data());\n    });\n   });\n },\n data: () => ({\n  messages: [],\n  body: \"\",\n  roomId: \"\",\n  room: null,\n  cards: [\"トーク\"],\n  drawer: null,\n  n: \"\",\n  auth: null,\n }),\n computed: {\n  invalid() {\n   if (!this.body) {\n    return true;\n   }\n   return false;\n  },\n },\n methods: {\n  clear() {\n   this.body = \"\";\n  },\n  submit() {\n   const roomRef = firebase.firestore().collection(\"rooms\").doc(this.roomId);\n   roomRef\n    .collection(\"messages\")\n    .add({\n     message: this.body,\n     name: this.auth.displayName,\n     photoURL: this.auth.photoURL,\n     createdAt: firebase.firestore.Timestamp.now(),\n    })\n    .then((result) => {\n     console.log(\"success\", result);\n     this.body = \"\";\n    })\n    .catch((error) => {\n     console.log(\"fail\", error);\n     alert(\"メッセージの送信に失敗しました\");\n    });\n  },\n\n  // deleteRoom() {\n  //  const room_id = this.$route.query.room_id;\n  //  firebase\n  //   .firestore()\n  //   .collection(\"rooms\")\n  //   .doc(room_id)\n  //   .delete()\n  //   .then(() => {\n  //    this.$router.push(\"/\");\n  //    console.log(room_id, \"は削除されました\");\n  //   });\n  // },\n },\n};\n</script>\n\n<style>\n.message {\n text-align: left;\n}\n\n.room-title {\n overflow: visible !important;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}