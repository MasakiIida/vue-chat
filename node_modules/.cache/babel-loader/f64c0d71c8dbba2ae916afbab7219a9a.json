{"ast":null,"code":"import _asyncToGenerator from \"/Users/masakiiida/Documents/Project/Portfolio/vue-chat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.json.stringify.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport firebase from \"@/firebase/firebase\";\nexport default {\n  mounted: function mounted() {\n    this.auth = JSON.parse(sessionStorage.getItem(\"user\"));\n    this.photoUrl = this.auth.photoURL;\n  },\n  data: function data() {\n    return {\n      drawer: null,\n      links: [[\"mdi-home\", \"ルーム\", \"/\"], [\"mdi-phone\", \"test\", \"/about\"]],\n      transparent: \"rgba(255, 255, 255, 0)\",\n      auth: null,\n      photoUrl: \"\"\n    };\n  },\n  methods: {\n    logout: function logout() {\n      var _this = this;\n\n      firebase.auth().signOut().then(function () {\n        localStorage.message = \"ログアウトしました\";\n\n        _this.$router.push(\"/login\");\n      }).catch(function (error) {\n        console.log(error);\n      });\n    },\n    changeIcon: function changeIcon() {\n      this.$refs.fileInput.click();\n    },\n    updateIcon: function updateIcon() {\n      var _this2 = this;\n\n      var user = this.getAuth();\n\n      if (!user) {\n        sessionStorage.removeItem(\"user\");\n        this.$router.push(\"/login\");\n      }\n\n      var file = this.$refs.fileInput.files[0];\n      console.log(file);\n      var filePath = \"/user/\".concat(file.name);\n      firebase.storage().ref().child(filePath).put(file).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(snapshot) {\n          var photoUrl;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return snapshot.ref.getDownloadURL();\n\n                case 2:\n                  photoUrl = _context.sent;\n                  console.log(\"download\", photoUrl);\n                  firebase.auth().onAuthStateChanged(function (user) {\n                    if (user) {\n                      user.updateProfile({\n                        photoURL: photoUrl\n                      });\n                      _this2.auth.photoURL = photoUrl;\n                      sessionStorage.setItem(\"user\", JSON.stringify(_this2.auth));\n                      _this2.photoUrl = photoUrl;\n                    }\n                  });\n\n                case 5:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    },\n    getAuth: function getAuth() {\n      return firebase.auth().onAuthStateChanged(function (user) {\n        return user;\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEA;AAEA;AACAA,SADA,qBACA;AACA;AAEA;AACA,GALA;AAMAC;AAAA;AACAC,kBADA;AAEAC,cACA,wBADA,EAEA,+BAFA,CAFA;AAMAC,2CANA;AAQAC,gBARA;AASAC;AATA;AAAA,GANA;AAiBAC;AACAC,UADA,oBACA;AAAA;;AACAC,eACAJ,IADA,GAEAK,OAFA,GAGAC,IAHA,CAGA;AACAC;;AACA;AACA,OANA,EAOAC,KAPA,CAOA;AACAC;AACA,OATA;AAUA,KAZA;AAaAC,cAbA,wBAaA;AACA;AACA,KAfA;AAgBAC,cAhBA,wBAgBA;AAAA;;AACA;;AACA;AACAC;AACA;AACA;;AAEA;AACAH;AACA;AAEAL,eACAS,OADA,GAEAC,GAFA,GAGAC,KAHA,CAGAC,QAHA,EAIAC,GAJA,CAIAC,IAJA,EAKAZ,IALA;AAAA,2EAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACAa,6BADA;;AAAA;AACAlB,0BADA;AAEAQ;AAEAL;AACA;AACAgB;AACAC;AADA;AAIA;AACAT;AAEA;AACA;AACA,mBAXA;;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SALA;;AAAA;AAAA;AAAA;AAAA;AAsBA,KAjDA;AAkDAU,WAlDA,qBAkDA;AACA;AACA;AACA,OAFA;AAGA;AAtDA;AAjBA","names":["mounted","data","drawer","links","transparent","auth","photoUrl","methods","logout","firebase","signOut","then","localStorage","catch","console","changeIcon","updateIcon","sessionStorage","storage","ref","child","filePath","put","file","snapshot","user","photoURL","getAuth"],"sourceRoot":"src/components/layouts","sources":["SideBar.vue"],"sourcesContent":["<template>\n <div id=\"app\">\n  <v-navigation-drawer v-model=\"drawer\" app>\n   <v-sheet color=\"grey lighten-4\" class=\"pa-4\">\n    <v-hover v-slot=\"{ hover }\">\n     <v-avatar\n      :class=\"{ 'hover-opacity': hover }\"\n      class=\"user-icon\"\n      color=\"indigo\"\n     >\n      <input\n       type=\"file\"\n       ref=\"fileInput\"\n       accept=\"image/jpeg, image/jpg, image/png\"\n       style=\"display: none\"\n       @change=\"updateIcon\"\n      />\n      <v-icon\n       :class=\"{ 'show-btns': hover }\"\n       :color=\"transparent\"\n       class=\"change-icon\"\n       >mdi-image-plus</v-icon\n      >\n      <v-icon\n       :class=\"{ 'hover-opacity': hover }\"\n       dark\n       v-if=\"!photoUrl\"\n       @click=\"changeIcon\"\n      >\n       mdi-account-circle\n      </v-icon>\n      <img\n       :class=\"{ 'hover-opacity': hover }\"\n       :src=\"photoUrl\"\n       v-if=\"photoUrl\"\n       @click=\"changeIcon\"\n      />\n     </v-avatar>\n    </v-hover>\n    <div class=\"username\">{{ auth && auth.displayName }}</div>\n   </v-sheet>\n\n   <v-divider></v-divider>\n\n   <v-list>\n    <v-list-item v-for=\"[icon, text, to] in links\" :key=\"icon\" :to=\"to\" link>\n     <v-list-item-icon>\n      <v-icon>{{ icon }}</v-icon>\n     </v-list-item-icon>\n\n     <v-list-item-content>\n      <v-list-item-title>{{ text }}</v-list-item-title>\n     </v-list-item-content>\n    </v-list-item>\n\n    <v-list-item @click=\"logout\">\n     <v-list-item-icon>\n      <v-icon> mdi-logout </v-icon>\n     </v-list-item-icon>\n\n     <v-list-item-content>\n      <v-list-item-title>Logout</v-list-item-title>\n     </v-list-item-content>\n    </v-list-item>\n   </v-list>\n  </v-navigation-drawer>\n </div>\n</template>\n\n<script>\nimport firebase from \"@/firebase/firebase\";\n\nexport default {\n mounted() {\n  this.auth = JSON.parse(sessionStorage.getItem(\"user\"));\n\n  this.photoUrl = this.auth.photoURL;\n },\n data: () => ({\n  drawer: null,\n  links: [\n   [\"mdi-home\", \"ルーム\", \"/\"],\n   [\"mdi-phone\", \"test\", \"/about\"],\n  ],\n  transparent: \"rgba(255, 255, 255, 0)\",\n\n  auth: null,\n  photoUrl: \"\",\n }),\n methods: {\n  logout() {\n   firebase\n    .auth()\n    .signOut()\n    .then(() => {\n     localStorage.message = \"ログアウトしました\";\n     this.$router.push(\"/login\");\n    })\n    .catch((error) => {\n     console.log(error);\n    });\n  },\n  changeIcon() {\n   this.$refs.fileInput.click();\n  },\n  updateIcon() {\n   const user = this.getAuth();\n   if (!user) {\n    sessionStorage.removeItem(\"user\");\n    this.$router.push(\"/login\");\n   }\n\n   const file = this.$refs.fileInput.files[0];\n   console.log(file);\n   const filePath = `/user/${file.name}`;\n\n   firebase\n    .storage()\n    .ref()\n    .child(filePath)\n    .put(file)\n    .then(async (snapshot) => {\n     const photoUrl = await snapshot.ref.getDownloadURL();\n     console.log(\"download\", photoUrl);\n\n     firebase.auth().onAuthStateChanged((user) => {\n      if (user) {\n       user.updateProfile({\n        photoURL: photoUrl,\n       });\n\n       this.auth.photoURL = photoUrl;\n       sessionStorage.setItem(\"user\", JSON.stringify(this.auth));\n\n       this.photoUrl = photoUrl;\n      }\n     });\n    });\n  },\n  getAuth() {\n   return firebase.auth().onAuthStateChanged((user) => {\n    return user;\n   });\n  },\n },\n};\n</script>\n\n<style>\n.hover-opacity {\n opacity: 0.5 !important;\n}\n\n.user-icon {\n position: relative;\n}\n\n.change-icon {\n position: absolute !important;\n top: 50%;\n left: 50%;\n transform: translate(-50%, -50%);\n}\n\n.show-btns {\n color: rgb(255, 255, 255) !important;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}